2025-12-28 14:47:09.253 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10c4656f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10ca246e0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10ca242f0>
                 │    └ <openai.AsyncOpenAI object at 0x10c20c980>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10c20c980>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10ca246e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10bd2e8d0>
                 └ <openai.AsyncOpenAI object at 0x10c20c980>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10bd28eb0>
          └ <openai.AsyncOpenAI object at 0x10c20c980>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 625, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10c271dd0>
    │      └ <function run at 0x103d33110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x103c86820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10c22e6c0>
           │      └ <function Runner.run at 0x103c86da0>
           └ <asyncio.runners.Runner object at 0x10c20e660>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x103d0d6c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10c20e660>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10c22e340>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 620, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10c271d20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 569, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern1 at 0x10c232f00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 264, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x10b5c9e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10b5eb8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c2946e0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb9697a090>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c20ea50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10b4c8300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c20f8c0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c2946e0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c294040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c265e50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10cab6680>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c2946e0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x103ad19b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c294980>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c2942f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c1c3ee0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c2c8040>
    └ <contextlib._GeneratorContextManager object at 0x10c1c3ee0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10b4cb320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c20f8c0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10b48d300>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10b48c5e0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10b48c590>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10b59f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10b59fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10bf60040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10bf60670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10bf31940>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:51:55.491 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bc996f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c250830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c250440>
                 │    └ <openai.AsyncOpenAI object at 0x10ba3cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10ba3cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c250830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b5a28d0>
                 └ <openai.AsyncOpenAI object at 0x10ba3cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b598eb0>
          └ <openai.AsyncOpenAI object at 0x10ba3cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10ba9ddd0>
    │      └ <function run at 0x10355b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x1034aa820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10ba5a6c0>
           │      └ <function Runner.run at 0x1034aada0>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x1035316c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10ba5a340>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10ba9dd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern1 at 0x10ba5ef00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x10ae39e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ae538a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10bac4830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xc442b7990>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ba3eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ad38300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ba3fa10
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10bac4830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10bac4190>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ba8df90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c2fd9c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10bac4830')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1032f59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10bac4ad0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10bac4440>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10b9eff50>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10baf4040>
    └ <contextlib._GeneratorContextManager object at 0x10b9eff50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10ad3b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ba3fa10
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10acfd170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10acfc450>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10acfc400>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ae0b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10ae0bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b7cc040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b7cc670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b7a18f0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:52:18.541 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bc996f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10de4dd10>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10de4da90>
                 │    └ <openai.AsyncOpenAI object at 0x10ba8ccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10ba8ccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10de4dd10>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b5a28d0>
                 └ <openai.AsyncOpenAI object at 0x10ba8ccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b598eb0>
          └ <openai.AsyncOpenAI object at 0x10ba8ccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10ba9ddd0>
    │      └ <function run at 0x10355b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x1034aa820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10ba5a6c0>
           │      └ <function Runner.run at 0x1034aada0>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x1035316c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10ba5a340>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10ba9dd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern3 at 0x10ba9ca90>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
               │              └ <function Agent.iter at 0x10ae538a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10de331d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xc43d03710>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c673e00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ad38300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c2e9a90
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10de331d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c253760>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10de64b40>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10de68ac0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10de331d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1032f59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c2a2050>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10de4c910>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10de64de0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c69f4c0>
    └ <contextlib._GeneratorContextManager object at 0x10de64de0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10ad3b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c2e9a90
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10acfd170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10acfc450>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10acfc400>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ae0b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10ae0bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b7cc040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b7cc670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b7a18f0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:52:18.830 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bc996f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10de60640>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10de60c30>
                 │    └ <openai.AsyncOpenAI object at 0x10ba222c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10ba222c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10de60640>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b5a28d0>
                 └ <openai.AsyncOpenAI object at 0x10ba222c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b598eb0>
          └ <openai.AsyncOpenAI object at 0x10ba222c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10ba9ddd0>
    │      └ <function run at 0x10355b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x1034aa820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10ba5a6c0>
           │      └ <function Runner.run at 0x1034aada0>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x1035316c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10ba5a340>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10ba9dd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern4 at 0x10ba9dbc0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x10ae39e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ae538a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10de33350')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xc43c53c10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10de64d00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ad38300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c295480
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10de33350')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c5ed7e0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10de66ba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c8c03c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10de33350')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1032f59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c8b4130>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c593820>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10de66cf0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c8b44a0>
    └ <contextlib._GeneratorContextManager object at 0x10de66cf0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10ad3b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c295480
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10acfd170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10acfc450>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10acfc400>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ae0b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10ae0bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b7cc040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b7cc670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b7a18f0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:52:19.130 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bc996f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c250830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c250440>
                 │    └ <openai.AsyncOpenAI object at 0x10ba3cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10ba3cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c250830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b5a28d0>
                 └ <openai.AsyncOpenAI object at 0x10ba3cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b598eb0>
          └ <openai.AsyncOpenAI object at 0x10ba3cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10ba9ddd0>
    │      └ <function run at 0x10355b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x1034aa820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10ba5a6c0>
           │      └ <function Runner.run at 0x1034aada0>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x1035316c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10ba3e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10ba5a340>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
          └ <function run_comparison at 0x10ba9dd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   └ <function run_pattern1 at 0x10ba5ef00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   │              └ <function AbstractAgent.run at 0x10ae39e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ae538a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10de33890')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xc43ccf490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10de66d60>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ad38300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10de60e90
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10de33890')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c5ee260>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10de67bd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c8cc1c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10de33890')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1032f59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10de5cb50>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10de62520>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10de67d20>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c8b5e00>
    └ <contextlib._GeneratorContextManager object at 0x10de67d20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10ad3b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10de60e90
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                   │    └ <property object at 0x10acfd170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10acfc450>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   │                     │   └ <property object at 0x10acfc400>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ae0b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10ae0bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include both Brazilian CLT and A...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b7cc040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b7cc670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b7a18f0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:54:42.796 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a018830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729cc4790>
          └ <contextlib._AsyncGeneratorContextManager object at 0x109f8eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x109f8fa10
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a018830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a018190>
          └ <contextlib._AsyncGeneratorContextManager object at 0x109fddf90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10a84d6c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10a018830')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10a018ad0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10a018440>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x109f3ff50>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x109fabe60>
    └ <contextlib._GeneratorContextManager object at 0x109f3ff50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x109f8fa10
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:00.561 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c382210')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729ef0f10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10a98d950>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10a839a90
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c382210')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a7a3760>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10b133c80>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3dbe40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c382210')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10a7f2850>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c39e850>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c3b5da0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10abef3e0>
    └ <contextlib._GeneratorContextManager object at 0x10c3b5da0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10a839a90
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:00.916 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381910')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729f8c010>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3bc450>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10a7e5480
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381910')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a9d9fc0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b5630>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3cb280>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c381910')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10abefcb0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3c1940>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c3b5550>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10abef760>
    └ <contextlib._GeneratorContextManager object at 0x10c3b5550>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10a7e5480
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:01.447 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c380a10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729f8d690>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b51d0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c3c2650
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c380a10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3e500>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b6740>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3ecf00>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c380a10')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c39b330>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3c1f30>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c3b6890>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f4200>
    └ <contextlib._GeneratorContextManager object at 0x10c3b6890>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c3c2650
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include both Brazilian CLT and A...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:11.411 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3819d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729f8e090>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b6900>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10abbbce0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3819d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a9d9e70>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b4910>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3ed7c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c3819d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10abf6810>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10abb9f20>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c3b4520>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f7760>
    └ <contextlib._GeneratorContextManager object at 0x10c3b4520>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10abbbce0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include both Brazilian CLT and A...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:11.763 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729f8e310>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b56a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10abb9370
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3de70>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae204b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae31e40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c381790')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae06ee0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10a82cd10>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae20590>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f7e60>
    └ <contextlib._GeneratorContextManager object at 0x10ae20590>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10abb9370
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include both Brazilian CLT and A...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:12.284 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383290')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72ab44290>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae20600>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c3e0e50
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383290')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3e500>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae219b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae2ee40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c383290')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae05b30>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3e2850>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae21a90>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10abefe60>
    └ <contextlib._GeneratorContextManager object at 0x10ae21a90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c3e0e50
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:45.822 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65190')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298e1e10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b4360>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c3b14f0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65190')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3ee30>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae884b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3ad900>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65190')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae863a0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae90230>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae88590>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f6880>
    └ <contextlib._GeneratorContextManager object at 0x10ae88590>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c3b14f0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:46.260 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383ad0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729f8d910>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b50f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c3b18b0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383ad0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a9d9e70>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b57f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae6d480>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c383ad0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae76fd0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3b09b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c3b4280>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10abee5e0>
    └ <contextlib._GeneratorContextManager object at 0x10c3b4280>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c3b18b0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:55:46.581 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383710')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298e3490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b4f30>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c3f5d30
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383710')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3f760>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae206e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3ca040>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c383710')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae74410>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f4210>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae20de0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1d460>
    └ <contextlib._GeneratorContextManager object at 0x10ae20de0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c3f5d30
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:56:07.611 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381550')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298e0010>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae8a9e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ae58a10
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381550')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3f4c0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae8b700>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae12c00>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c381550')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae05220>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae1edd0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae8b7e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1fa00>
    └ <contextlib._GeneratorContextManager object at 0x10ae8b7e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ae58a10
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:56:07.911 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383410')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298e2310>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae8b850>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c383950
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383410')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3f370>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae23af0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae7b980>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c383410')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c3cfd90>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae1e0b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae23380>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1d540>
    └ <contextlib._GeneratorContextManager object at 0x10ae23380>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c383950
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:56:08.221 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae64050')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298d1190>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae23310>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ae647d0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae64050')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3f760>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae201a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae8c400>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae64050')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae76a30>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f5d30>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae214e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f4200>
    └ <contextlib._GeneratorContextManager object at 0x10ae214e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ae647d0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.', timestam...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:56:28.394 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a5956f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10ab4c830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10ab4c440>
                 │    └ <openai.AsyncOpenAI object at 0x10a338ad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10a338ad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10ab4c830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109e9a8d0>
                 └ <openai.AsyncOpenAI object at 0x10a338ad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109e94eb0>
          └ <openai.AsyncOpenAI object at 0x10a338ad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10a399dd0>
    │      └ <function run at 0x101e1b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x101d6e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10a3566c0>
           │      └ <function Runner.run at 0x101d6eda0>
           └ <asyncio.runners.Runner object at 0x10a33a7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101df56c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10a33a7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10a356340>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10a399d20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern1 at 0x10a359c70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x109731e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10974f8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a3bc830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xc63d24010>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10a33aba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109634300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10a33ba10
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a3bc830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a3bc190>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10a38df90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10abf96c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10a3bc830')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x101bb99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10a3bcad0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10a3bc440>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10a2ebee0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10a3f0040>
    └ <contextlib._GeneratorContextManager object at 0x10a2ebee0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x109637320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10a33ba10
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x1095f9080>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x1095f8360>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x1095f8310>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x1097077f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x109707b60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10a0c8040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10a0c8670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10a0a1850>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:56:43.020 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65a90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abb9910>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b6820>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aea1c80
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65a90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3e650>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae8a200>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aeaf040>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65a90')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec0b40>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f42f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae89b00>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1f4c0>
    └ <contextlib._GeneratorContextManager object at 0x10ae89b00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aea1c80
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.', timestam...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:56:43.551 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65cd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729f8e090>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae8a900>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aea2af0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65cd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a9d9e70>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb1010>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aecd480>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65cd0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec1540>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae1f5b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10aeb10f0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1dc40>
    └ <contextlib._GeneratorContextManager object at 0x10aeb10f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aea2af0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.', timestam...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:56:43.921 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae64c50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72993ed10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb1160>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aea3280
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae64c50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5ceb0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb22e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aeb7080>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae64c50')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec2530>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae1d390>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10aeb23c0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae943c0>
    └ <contextlib._GeneratorContextManager object at 0x10aeb23c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 l...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aea3280
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs rel...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from both BR and US courts.',...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs rel...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:57:26.950 | WARNING  | DDGS search failed for '"appellate brief" civil litigation U.S. Court of Appeals PDF site:causc.uscourts.gov': No results found.
2025-12-28 14:57:34.641 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65f10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298e1190>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b7150>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aea2d00
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65f10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3d930>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb20b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aedf4c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65f10')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae50e10>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f7770>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10aeb3310>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f4900>
    └ <contextlib._GeneratorContextManager object at 0x10aeb3310>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 l...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aea2d00
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs rel...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from both BR and US courts.',...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs rel...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:57:34.921 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 legal briefs related to civil litigation from both BR and US courts.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae668d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298df710>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb32a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aea36a0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae668d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3da80>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb0360>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3c8e00>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae668d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae51720>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae1d630>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10aeb2580>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae950e0>
    └ <contextlib._GeneratorContextManager object at 0x10aeb2580>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 l...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aea36a0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs relate...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs rel...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs related to civil litigation from both BR and US courts.',...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal briefs rel...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:57:35.354 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae665d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72993f710>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aea3d80
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae665d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3f610>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad14360>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aeafa80>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae665d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae76760>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae95fd0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad14600>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae96880>
    └ <contextlib._GeneratorContextManager object at 0x10ad14600>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 l...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aea3d80
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.',...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:58:02.784 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad30710')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abb9b90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae239a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1d2e0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad30710')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3de70>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16040>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad0ce40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad30710')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad08c80>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f7e70>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad155c0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f75a0>
    └ <contextlib._GeneratorContextManager object at 0x10ad155c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 l...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1d2e0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.',...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:58:03.141 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad30c50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729ef1910>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad15160>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1d910
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad30c50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5d690>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16890>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad24380>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad30c50')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad09680>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae96c10>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad169e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae95380>
    └ <contextlib._GeneratorContextManager object at 0x10ad169e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 l...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1d910
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (par...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (pareceres or opinion letters) from any jurisdiction.',...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 legal opinions (...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:58:03.493 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31190')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72ab44790>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16a50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1dff0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31190')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5d7e0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad17cb0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad3b680>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad31190')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad0ab20>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae96430>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad17e00>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae965e0>
    └ <contextlib._GeneratorContextManager object at 0x10ad17e00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1dff0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian and American law.', tim...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:58:32.161 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae665d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abba090>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad17e70>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1c050
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae665d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3e8f0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb0750>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aedd780>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae665d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c3dc460>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae97230>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10aeb2eb0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae97760>
    └ <contextlib._GeneratorContextManager object at 0x10aeb2eb0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1c050
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian and American law.', tim...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:58:32.511 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 corporate or tax legal opinions from Brazilian and American law.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c382510')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298d0790>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb2580>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1eaf0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c382510')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5cd60>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad41160>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad50bc0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c382510')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad096d0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae1cf30>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad412b0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1ef80>
    └ <contextlib._GeneratorContextManager object at 0x10ad412b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1eaf0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax le...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax legal opinions from Brazilian and American law.', tim...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate or tax...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:58:33.032 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381610')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72993d190>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad41320>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1f330
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381610')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5cac0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad42580>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3ae540>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c381610')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad088c0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2c750>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad426d0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2d000>
    └ <contextlib._GeneratorContextManager object at 0x10ad426d0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1f330
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, prop...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, prop...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, property) from both jurisdic...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:59:01.882 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65610')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298de810>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae23c40>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1d5a0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65610')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3f370>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad40c20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad0e980>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65610')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5c5a0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f7af0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad40bb0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae95620>
    └ <contextlib._GeneratorContextManager object at 0x10ad40bb0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1d5a0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, prop...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, prop...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, property) from both jurisdic...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:59:02.202 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about real estate (lease, sale, property) from both jurisdictions.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67a10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298dcf10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad41080>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1d230
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67a10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5dfc0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad43310>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aedea00>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae67a10')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5d4f0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2d7f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad43460>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2dfc0>
    └ <contextlib._GeneratorContextManager object at 0x10ad43460>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1d230
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about rea...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, prop...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, prop...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about real estate (lease, sale, property) from both jurisdic...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:59:02.551 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about commercial real estate or residential property.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about commercial real estate or residential property.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents about commercial real estate or residential property.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383ad0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298df490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16f90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1cb50
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c383ad0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3fb50>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16740>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae2d440>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c383ad0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad0b480>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae967b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad155c0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae96c00>
    └ <contextlib._GeneratorContextManager object at 0x10ad155c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1cb50
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or resi...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or resi...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or residential property.', time...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:59:10.741 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about commercial real estate or residential property.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about commercial real estate or residential property.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents about commercial real estate or residential property.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67dd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729f8d910>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad162e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1f490
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67dd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3da80>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad40d00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad0f900>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae67dd0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae50780>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f43d0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad42eb0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1e0a0>
    └ <contextlib._GeneratorContextManager object at 0x10ad42eb0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1f490
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or resi...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or resi...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or residential property.', time...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:59:11.121 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about commercial real estate or residential property.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about commercial real estate or residential property.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae66ed0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729941b90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad41f60>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1f070
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae66ed0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5cc10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad43850>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae133c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae66ed0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae85ea0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2eb30>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad439a0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2cc80>
    └ <contextlib._GeneratorContextManager object at 0x10ad439a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1f070
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about com...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or resi...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or resi...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about commercial real estate or residential property.', time...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 14:59:11.512 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299dca10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad43a10>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1f490
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3dbd0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad416a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aecd900>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c3bb200>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae1f690>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad41470>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f7060>
    └ <contextlib._GeneratorContextManager object at 0x10ad41470>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 t...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1f490
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related docu...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.', ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related docu...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:10.476 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67890')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299e6310>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16660>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1f120
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67890')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3fb50>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb1390>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aede9c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae67890')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5c5a0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2dd30>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10aeb1080>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2fbc0>
    └ <contextlib._GeneratorContextManager object at 0x10aeb1080>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 t...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1f120
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related docu...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.', ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related docu...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:10.803 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae66f90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abb8f10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1f1d0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae66f90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e3b0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad40d70>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad878c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae66f90')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec05f0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae96cf0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad41390>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae94740>
    └ <contextlib._GeneratorContextManager object at 0x10ad41390>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 t...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1f1d0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documen...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related docu...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related documents (briefs, opinions) from Brazilian and US law.', ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 tax-related docu...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:11.172 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67350')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299e7c10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad414e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad94260
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67350')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5dbd0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad759b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad7e1c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae67350')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec1860>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f49f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad75da0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f43c0>
    └ <contextlib._GeneratorContextManager object at 0x10ad75da0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad94260
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS m...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS m...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS matters.', timestamp=date...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:25.610 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a36d6f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a924830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a924440>
                 │    └ <openai.AsyncOpenAI object at 0x10a114ad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10a114ad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a924830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109c328d0>
                 └ <openai.AsyncOpenAI object at 0x10a114ad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109c2ceb0>
          └ <openai.AsyncOpenAI object at 0x10a114ad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10a171dd0>
    │      └ <function run at 0x101d3b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x101c8e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10a12e6c0>
           │      └ <function Runner.run at 0x101c8eda0>
           └ <asyncio.runners.Runner object at 0x10a1167b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101d156c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10a1167b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10a12e340>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10a171d20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern1 at 0x10a131c70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x1094c9e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1094eb8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a198830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x9aeef4f10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10a116ba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x1093cc300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10a117a10
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a198830')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10a198190>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10a165f90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10a9d1bc0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10a198830')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x101ad99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10a198ad0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10a198440>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10a0c3ee0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10a1c8040>
    └ <contextlib._GeneratorContextManager object at 0x10a0c3ee0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x1093cf320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10a117a10
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x1093910d0>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x1093903b0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x109390360>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10949f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10949fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109e60040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109e60670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109e39850>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:31.003 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae66810')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abb8790>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad427b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad1fd80
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae66810')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3fb50>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad17150>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aeceb40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae66810')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5e1c0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f7af0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad16cf0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae96dc0>
    └ <contextlib._GeneratorContextManager object at 0x10ad16cf0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad1fd80
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS m...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS m...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS matters.', timestamp=date...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:31.436 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about tax compliance, ICMS, or IRS matters.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65e50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abbaf90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16eb0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad94b50
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65e50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e260>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad76c80>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad92640>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65e50')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5c050>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2fe70>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad779a0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2f4c0>
    └ <contextlib._GeneratorContextManager object at 0x10ad779a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad94b50
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS m...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS m...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about tax compliance, ICMS, or IRS matters.', timestamp=date...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:31.862 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31010')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299ddb90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad77d90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad959c0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31010')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e650>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad756a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10adb85c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad31010')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5f8e0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada0750>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad75b00>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada1380>
    └ <contextlib._GeneratorContextManager object at 0x10ad75b00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad959c0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law do...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions, or securities.', times...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law do...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:54.332 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729ef3490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c3b6c80>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad95bd0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3d930>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad14a60>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae8d200>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5e8a0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2e190>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad16f90>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae97ca0>
    └ <contextlib._GeneratorContextManager object at 0x10ad16f90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad95bd0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law do...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions, or securities.', times...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law do...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:54.714 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 corporate law documents: mergers, acquisitions, or securities.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad30710')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abba310>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad167b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad95020
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad30710')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5dd20>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad41b00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad86d80>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad30710')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec26c0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f4050>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad40360>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c3f6c00>
    └ <contextlib._GeneratorContextManager object at 0x10ad40360>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad95020
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law docum...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law do...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law documents: mergers, acquisitions, or securities.', times...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 corporate law do...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:00:55.062 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31250')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299e6810>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad41390>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad95440
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31250')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5c820>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb0980>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10adbddc0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad31250')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec3d90>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada0050>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adb0bb0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada2b20>
    └ <contextlib._GeneratorContextManager object at 0x10adb0bb0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad95440
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) f...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related docu...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) f...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.', ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related docu...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:01:45.023 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32210')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299e8290>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad14a60>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad94310
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32210')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3d930>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb1e10>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10addc400>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad32210')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ade0730>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2f310>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adb1be0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2d540>
    └ <contextlib._GeneratorContextManager object at 0x10adb1be0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad94310
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) f...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related docu...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) f...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.', ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related docu...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:01:45.365 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32510')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299e9e10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb1a90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad97280
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32510')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5d930>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb2f90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10adbdd40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad32510')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ade2030>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada2350>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adb30e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada20a0>
    └ <contextlib._GeneratorContextManager object at 0x10adb30e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad97280
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documen...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) f...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related docu...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) f...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related documents (opinions, agreements) from any jurisdiction.', ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 M&A-related docu...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:01:45.835 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65e50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299eb490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad75b70>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad94310
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65e50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ab3dbd0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad75240>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c3d1cc0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65e50')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10adca940>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2e430>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad769e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2e260>
    └ <contextlib._GeneratorContextManager object at 0x10ad769e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad94310
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Bra...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 U...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Bra...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:09.754 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abb8290>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad77e70>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10adec1b0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e110>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf0fa0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10adf4280>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad31790')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5f7f0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada0c90>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adf10f0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada1000>
    └ <contextlib._GeneratorContextManager object at 0x10adf10f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10adec1b0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Bra...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 U...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Bra...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:10.062 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 US brief.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad328d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298d1910>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf1160>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10adeccb0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad328d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5f220>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf2350>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad53500>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad328d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c3bb250>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada2eb0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adb3af0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae944a0>
    └ <contextlib._GeneratorContextManager object at 0x10adb3af0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10adeccb0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazil...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Bra...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Brazilian contract, 1 US contract, 1 Brazilian brief, 1 U...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents: 1 Bra...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:10.382 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7298d2590>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb00c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad96d00
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5ece0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb1860>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10addf6c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c3828d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae07e80>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f4910>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adb10f0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae1c3c0>
    └ <contextlib._GeneratorContextManager object at 0x10adb10f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad96d00
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdict...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from S...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdict...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdictions.', timestamp=dateti...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from S...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:28.003 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31010')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729942590>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb1320>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aded390
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31010')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e500>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf24a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10adfbbc0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad31010')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10adcb1b0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada0e50>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adf25f0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada1000>
    └ <contextlib._GeneratorContextManager object at 0x10adf25f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aded390
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdict...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from S...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdict...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdictions.', timestamp=dateti...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from S...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:28.303 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents from Sao Paulo or New York jurisdictions.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32a50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299e9410>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf2660>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aded910
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32a50')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5f4c0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf3850>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad39280>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad32a50')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ade2a30>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ac0c130>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adf39a0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ac0c900>
    └ <contextlib._GeneratorContextManager object at 0x10adf39a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aded910
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdict...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from S...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdict...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from Sao Paulo or New York jurisdictions.', timestamp=dateti...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents from S...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:28.663 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents related to consumer protection or civil disputes.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents related to consumer protection or civil disputes.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents related to consumer protection or civil disputes.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae64590')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729942810>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10aeb3230>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad96ba0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae64590')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5ea40>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16e40>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae2fb40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae64590')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec2580>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ad2ec10>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad146e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ad2f680>
    └ <contextlib._GeneratorContextManager object at 0x10ad146e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad96ba0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or ci...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents relate...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or ci...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or civil disputes.', timestam...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents relate...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:40.413 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents related to consumer protection or civil disputes.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents related to consumer protection or civil disputes.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents related to consumer protection or civil disputes.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad307d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299eaf90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad42a50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10adecb50
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad307d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e650>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf1320>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ad85200>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad307d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae74320>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c3f6f90>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adf0d00>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae97a00>
    └ <contextlib._GeneratorContextManager object at 0x10adf0d00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10adecb50
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or ci...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents relate...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or ci...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or civil disputes.', timestam...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents relate...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:40.712 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents related to consumer protection or civil disputes.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents related to consumer protection or civil disputes.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32150')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abbaf90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf0de0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10adec1b0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32150')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e3b0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf3c40>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aede900>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad32150')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae05a40>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ac0c830>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adf3d90>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ac0c040>
    └ <contextlib._GeneratorContextManager object at 0x10adf3d90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10adec1b0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related t...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or ci...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents relate...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or ci...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents related to consumer protection or civil disputes.', timestam...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents relate...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:02:41.022 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about appeals, indemnification, or damages.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about appeals, indemnification, or damages.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents about appeals, indemnification, or damages.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381a90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abba310>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb0980>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad94260
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381a90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5f220>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb2b30>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10adfad80>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c381a90')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5dfe0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae944b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adb16a0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae97bc0>
    └ <contextlib._GeneratorContextManager object at 0x10adb16a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad94260
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or d...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or d...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or damages.', timestamp=date...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:03:00.383 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about appeals, indemnification, or damages.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about appeals, indemnification, or damages.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents about appeals, indemnification, or damages.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31c10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729943210>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb10f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10adec890
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad31c10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5ef80>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae00750>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ac1e100>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad31c10')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ade3d90>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada1010>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae008a0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada27a0>
    └ <contextlib._GeneratorContextManager object at 0x10ae008a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10adec890
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or d...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or d...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or damages.', timestamp=date...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
