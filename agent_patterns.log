2025-12-28 15:03:00.684 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about appeals, indemnification, or damages.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about appeals, indemnification, or damages.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32ed0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299ec290>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae00910>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10adedff0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad32ed0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5fb50>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae01b00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ae8c640>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad32ed0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ac28af0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ac0cc90>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae01c50>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ac0dfc0>
    └ <contextlib._GeneratorContextManager object at 0x10ae01c50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10adedff0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about app...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or d...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or d...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about appeals, indemnification, or damages.', timestamp=date...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:03:01.043 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299ed690>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad427b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad97120
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae65790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5fa00>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad76200>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ac1c800>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae65790')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10adc9cc0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ae95470>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad758d0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ae97bc0>
    └ <contextlib._GeneratorContextManager object at 0x10ad758d0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad97120
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, SEC, LGPD).', timestamp=...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:03:23.174 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad33350')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abca090>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad746e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10aded440
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad33350')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e7a0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae00360>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ac44d40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad33350')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ac29a40>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada2cf0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ae02270>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada3060>
    └ <contextlib._GeneratorContextManager object at 0x10ae02270>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10aded440
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, SEC, LGPD).', timestamp=...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:03:23.493 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 compliance-related documents (anticorruption, SEC, LGPD).'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381a90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abcad10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb39a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad96fc0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381a90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5fdf0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb16a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ac37e40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c381a90')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ae07890>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada11d0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adb1940>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada10e0>
    └ <contextlib._GeneratorContextManager object at 0x10adb1940>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad96fc0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-related documents (anticorruption, SEC, LGPD).', timestamp=...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 compliance-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:03:23.814 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a7a0440>
                 │    └ <openai.AsyncOpenAI object at 0x109f8cad0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f8cad0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a7a0830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f8cad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f8cad0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents and provide a concise summary of each one.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents and provide a concise summary of each one.'
                   └ <function run_pattern1 at 0x109fadc70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 266, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents and provide a concise summary of each one.'
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381cd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x72abc8290>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adb3af0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad96d00
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c381cd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5e650>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10adf25f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10adf6940>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c381cd0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10aec0320>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ada25f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10adf14e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ada12a0>
    └ <contextlib._GeneratorContextManager object at 0x10adf14e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad96d00
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of eac...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and pr...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of eac...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of each one.', timestamp=datet...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and pr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:03:42.653 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c39f390>
                 │    └ <openai.AsyncOpenAI object at 0x109fdccd0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109fdccd0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c39dbd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109fdccd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109fdccd0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents and provide a concise summary of each one.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents and provide a concise summary of each one.'
                   └ <function run_pattern3 at 0x109fec7d0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 415, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents and provide a concise summary of each one.'
               │              └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad33950')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x729942d10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad769e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10adee780
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ad33950')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5dd20>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ae03f50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10ac4e500>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ad33950')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ac28fa0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ac0f3f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ac50130>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ac0fa00>
    └ <contextlib._GeneratorContextManager object at 0x10ac50130>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10adee780
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of eac...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and pr...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of eac...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of each one.', timestamp=datet...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and pr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:03:42.983 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10a1e96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c3c0640>
                 │    └ <openai.AsyncOpenAI object at 0x109f722c0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109f722c0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c3c0050>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109af28d0>
                 └ <openai.AsyncOpenAI object at 0x109f722c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x109ae8eb0>
          └ <openai.AsyncOpenAI object at 0x109f722c0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 629, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109feddd0>
    │      └ <function run at 0x101a2b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10197a820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109faa5e0>
           │      └ <function Runner.run at 0x10197ada0>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x101a016c0>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109f8e7b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109faa260>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 624, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents and provide a concise summary of each one.'
          └ <function run_comparison at 0x109fedd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 573, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents and provide a concise summary of each one.'
                   └ <function run_pattern4 at 0x109feceb0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 516, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x109381e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x1093a78a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=__main__.ContinueA...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67dd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0x7299de810>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad16890>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x109288300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10ad95ff0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10ae67dd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10ae5ea40>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10ad41710>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10aece140>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10ae67dd0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1017c59b0>
          │    └ <contextlib.AsyncExitStack object at 0x10ad5e530>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10ac0e5f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10ad42ba0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10ac0f840>
    └ <contextlib._GeneratorContextManager object at 0x10ad42ba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10928b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10ad95ff0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                   │    └ <property object at 0x10924d170>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10924c4a0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                 │    │   │                     │   └ <property object at 0x10924c450>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provi...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10935b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of eac...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and pr...
                 │    └ <function ModelRequestNode._make_request at 0x10935bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of eac...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and provide a concise summary of each one.', timestamp=datet...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109d1c040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents and pr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109d1c670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109cf58a0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:19:57.915 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10d7956f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7cc20>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dc7c830>
                 │    └ <openai.AsyncOpenAI object at 0x10d518ec0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10d518ec0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7cc20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10d0a28d0>
                 └ <openai.AsyncOpenAI object at 0x10d518ec0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10d09ceb0>
          └ <openai.AsyncOpenAI object at 0x10d518ec0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10d599dd0>
    │      └ <function run at 0x104fa7110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x104efa820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10d55e420>
           │      └ <function Runner.run at 0x104efada0>
           └ <asyncio.runners.Runner object at 0x10d51aba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x104fa9540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10d51aba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10d55e0a0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10d599d20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern1 at 0x10d561c70>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 263, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x10c931e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10c95b8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10d5c0c20')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xa0eaf9b90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10d51af90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10c838300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10d51be00
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10d5c0c20')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10d5c0580>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10d58de50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10dd36d80>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10d5c0c20')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x104d459b0>
          │    └ <contextlib.AsyncExitStack object at 0x10d5c0ec0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10d5c0830>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10d4eff50>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10d55fca0>
    └ <contextlib._GeneratorContextManager object at 0x10d4eff50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10c83b320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10d51be00
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10c7f93f0>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10c7f86d0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10c7f8680>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10c90b7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10c90bb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='_search', parameters_json_schema={'additionalProperties': False, ...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10d2d0040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10d2d0670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10d299ad0>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:23:26.489 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c06c830>
                 │    └ <openai.AsyncOpenAI object at 0x10b84cec0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b84cec0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b84cec0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b84cec0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern1 at 0x10b89af00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 263, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10b8f4c20')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96c74290>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10b84ef90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10b84fe00
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10b8f4c20')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10b8f4580>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10b8c1e50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c1229c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10b8f4c20')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10b8f4ec0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10b8f4830>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10b827f50>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10b893d80>
    └ <contextlib._GeneratorContextManager object at 0x10b827f50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10b84fe00
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='_search', parameters_json_schema={'additionalProperties': False, ...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:07.838 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dc7e350>
                 │    └ <openai.AsyncOpenAI object at 0x10b8c0b90>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b8c0b90>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b8c0b90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b8c0b90>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern3 at 0x10b8cca90>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 412, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
               │              └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700650')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f1e090>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c272890>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c119950
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700650')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c06f8b0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc83af0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c6e0d40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c700650')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c0d2150>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10dc7f390>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10dc83bd0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c4d73e0>
    └ <contextlib._GeneratorContextManager object at 0x10dc83bd0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c119950
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='___search', parameters_json_schema={'additionalProperties': False...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:08.157 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dcadf30>
                 │    └ <openai.AsyncOpenAI object at 0x10b88d940>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b88d940>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b88d940>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b88d940>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 employment-related legal documents (contracts or briefs) from both Brazilian and US law.'
                   └ <function run_pattern4 at 0x10b8cc300>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 632, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700890')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96dc3c10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc83c40>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10dcaefd0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700890')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40fdf0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c710f30>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c714a40>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c700890')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10dc91c50>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10dcacb00>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c711080>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc91b60>
    └ <contextlib._GeneratorContextManager object at 0x10c711080>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 e...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10dcaefd0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related ...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-related legal documents (contracts or briefs) from both Bra...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 employment-relat...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:08.636 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c06c830>
                 │    └ <openai.AsyncOpenAI object at 0x10b84cec0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b84cec0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b84cec0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b84cec0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   └ <function run_pattern1 at 0x10b89af00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 263, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700a10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f36a90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c7110f0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10dcaeb10
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700a10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40f610>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c712120>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c7170c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c700a10')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c6f8310>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10dcaf820>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c712270>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc92c00>
    └ <contextlib._GeneratorContextManager object at 0x10c712270>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10dcaeb10
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='_search', parameters_json_schema={'additionalProperties': False, ...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include both Brazilian CLT and A...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:20.805 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dc7e350>
                 │    └ <openai.AsyncOpenAI object at 0x10b8c0b90>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b8c0b90>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b8c0b90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b8c0b90>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   └ <function run_pattern3 at 0x10b8cca90>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 412, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
               │              └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f89690>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc83ee0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c43f680
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61790')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c06f8b0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c7107c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10dc8ed80>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10dc61790')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c4bbef0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c43e030>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c7106e0>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c4d7760>
    └ <contextlib._GeneratorContextManager object at 0x10c7106e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c43f680
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='___search', parameters_json_schema={'additionalProperties': False...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include both Brazilian CLT and A...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:21.185 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dcadf30>
                 │    └ <openai.AsyncOpenAI object at 0x10b88d940>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b88d940>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b88d940>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b88d940>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 documents about labor and employment. Include both Brazilian CLT and American contracts.'
                   └ <function run_pattern4 at 0x10b8cc300>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 632, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc62090')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f50a10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c710130>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c43df20
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc62090')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40e8f0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c713460>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c738040>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10dc62090')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c71e350>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c43dae0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c713540>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc91b60>
    └ <contextlib._GeneratorContextManager object at 0x10c713540>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 d...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c43df20
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about lab...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about labor and employment. Include both Brazilian CLT and A...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 documents about ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:21.545 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c06c830>
                 │    └ <openai.AsyncOpenAI object at 0x10b84cec0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b84cec0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b84cec0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b84cec0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   └ <function run_pattern1 at 0x10b89af00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 263, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61d90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f53490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c7135b0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10dcce850
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61d90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40f0d0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c73c750>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c744400>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10dc61d90')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c71ed00>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10dccee50>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c73c830>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc912a0>
    └ <contextlib._GeneratorContextManager object at 0x10c73c830>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10dcce850
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='_search', parameters_json_schema={'additionalProperties': False, ...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:55.635 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dc7e350>
                 │    └ <openai.AsyncOpenAI object at 0x10b8c0b90>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b8c0b90>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b8c0b90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b8c0b90>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   └ <function run_pattern3 at 0x10b8cca90>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 412, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
               │              └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700410')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f05b90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c713e00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10dc94c80
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700410')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40f370>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc838c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c7449c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c700410')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c74c3c0>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c6e98b0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10dc83d20>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc919a0>
    └ <contextlib._GeneratorContextManager object at 0x10dc83d20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10dc94c80
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='___search', parameters_json_schema={'additionalProperties': False...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:56.025 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dcadf30>
                 │    └ <openai.AsyncOpenAI object at 0x10b88d940>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b88d940>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b88d940>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b88d940>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse types.'
                   └ <function run_pattern4 at 0x10b8cc300>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 632, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700e90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f68f10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c73c8a0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c6eac60
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700e90')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c740040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c73c440>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10dc7b8c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c700e90')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c74dd10>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c6eb2f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c73c360>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c4d66c0>
    └ <contextlib._GeneratorContextManager object at 0x10c73c360>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c6eac60
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from B...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from Ame...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 from Brazilian law and 2 from American law. Save diverse ...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 contracts: 2 fro...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:24:56.356 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c06c830>
                 │    └ <openai.AsyncOpenAI object at 0x10b84cec0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b84cec0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b84cec0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b84cec0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   └ <function run_pattern1 at 0x10b89af00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 263, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61010')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96f6b490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc837e0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10dc919b0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61010')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40e7a0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc831c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10dca09c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10dc61010')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10dcc5090>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10dc925f0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10dc82350>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc933e0>
    └ <contextlib._GeneratorContextManager object at 0x10dc82350>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10dc919b0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='_search', parameters_json_schema={'additionalProperties': False, ...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:25:49.216 | ERROR    | ❌ Pattern 3: iter() API failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dc7e350>
                 │    └ <openai.AsyncOpenAI object at 0x10b8c0b90>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b8c0b90>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dc7df90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b8c0b90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b8c0b90>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   └ <function run_pattern3 at 0x10b8cca90>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 412, in run_pattern3
    async with pattern3_agent.iter(prompt, deps=deps) as run:
               │              │    │            │        └ <AgentRun result=<run not finished> usage=RunUsage()>
               │              │    │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason='')
               │              │    └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
               │              └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name=None, end_strategy='early', model_settings=None, output_type=<class '__main__.Pattern1Resul...

  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61fd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96ffd410>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c710ad0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10dc668f0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc61fd0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40f760>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c713af0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c7640c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10dc61fd0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c71d400>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10dc91390>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c713a10>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc92340>
    └ <contextlib._GeneratorContextManager object at 0x10c713a10>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10dc668f0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='___search', parameters_json_schema={'additionalProperties': False...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P3-iter', is_finished=False, finish_reason=...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:25:49.517 | ERROR    | ❌ Pattern 4: Union Continue/Finish failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10dcadf30>
                 │    └ <openai.AsyncOpenAI object at 0x10b88d940>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b88d940>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10dcadba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b88d940>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b88d940>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa).'
                   └ <function run_pattern4 at 0x10b8cc300>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 632, in run_pattern4
    result = await pattern4_agent.run(
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern4_agent', end_strategy='early', model_settings=None, output_type=[<class '__main__....
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc63650')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96e5b490>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c7138c0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10dc625d0
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10dc63650')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40ea40>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc81cc0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c73bc80>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10dc63650')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c749590>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10dc91710>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10dc81940>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10dc90c80>
    └ <contextlib._GeneratorContextManager object at 0x10dc81940>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10dc625d0
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contract...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both juris...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='search', parameters_json_schema={'additionalProperties': False, '...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contracts or leases from both jurisdictions (brazil and usa...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P4-union', is_finished=False, finish_reason...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 commercial contr...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:25:49.835 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x10bac96f0>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10c06c830>
                 │    └ <openai.AsyncOpenAI object at 0x10b84cec0>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x10b84cec0>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10c06cc20>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x10b3d68d0>
                 └ <openai.AsyncOpenAI object at 0x10b84cec0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10b3d0eb0>
          └ <openai.AsyncOpenAI object at 0x10b84cec0>

openai.UnprocessableEntityError: Error code: 422 - {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 745, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x10b8cddd0>
    │      └ <function run at 0x10331b110>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x10326e820>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x10b892500>
           │      └ <function Runner.run at 0x10326eda0>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10331d540>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10b84eba0>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x10b892180>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 740, in main
    await run_comparison(prompt, target=5)
          │              └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
          └ <function run_comparison at 0x10b8cdd20>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 689, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
                   └ <function run_pattern1 at 0x10b89af00>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 263, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_reason='')
                   │              │   └ 'Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.'
                   │              └ <function AbstractAgent.run at 0x10ac65e80>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x10ac8b8a0>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=<class '__main__.P...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700d10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xb96e59410>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10dc83540>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x10ab6c300>
               └ <pydantic_graph.beta.graph.Graph object at 0x10c700110
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10c700d10')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x10c40f370>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10c73e430>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10c745040>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10c700d10')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1030b99b0>
          │    └ <contextlib.AsyncExitStack object at 0x10c74a490>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10c75e6d0>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10c73e510>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10c75dd20>
    └ <contextlib._GeneratorContextManager object at 0x10c73e510>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 422, model_name: zai-glm-4.6, body: {\'message\': "Tools with mixed values for \'strict\' are no...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 c...
                   │    └ <function _GraphIterator._run_task at 0x10ab6f320>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10c700110
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                   │    └ <property object at 0x10ab2d440>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x10ab2c720>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   │                     │   └ <property object at 0x10ab2c6d0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Bra...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x10ac3f7f0>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
                 │    └ <function ModelRequestNode._make_request at 0x10ac3fb60>
                 └ ModelRequestNode(request=ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 Amer...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='_search', parameters_json_schema={'additionalProperties': False, ...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 Brazilian petitions and 2 American motions.', timestam...
                           │   │    │     └ <function OpenAIChatModel.request at 0x10b604040>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[], actions=[], target_count=5, pattern_name='P1-implicit', is_finished=False, finish_rea...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 court briefs: 2 ...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x10b604670>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x10b5d1b20>
          │                          │                       └ CerebrasModel()
          │                          └ 422
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 422, model_name: zai-glm-4.6, body: {'message': "Tools with mixed values for 'strict' are not allowed. Please set all tools to 'strict: true' or 'strict: false'", 'type': 'invalid_request_error', 'param': 'tools', 'code': 'wrong_api_format'}
2025-12-28 15:33:47.821 | WARNING  | DDGS search failed for 'site:gov.br "employment discrimination" PDF EEOC complaint': No results found.
2025-12-28 15:34:30.824 | WARNING  | DDGS search failed for '"US employment contract" filetype:pdf government site:usa.gov': No results found.
2025-12-28 15:47:49.198 | WARNING  | DDGS search failed for 'site:pacer.gov EEOC discrimination complaint PDF': Request timed out: ConnectTimeout('timed out')
2025-12-28 15:59:15.192 | WARNING  | DDGS search failed for 'site:trt{}.jus.br "recurso ordinário" PDF completo 2024': Request timed out: ConnectTimeout('timed out')
2025-12-28 15:59:53.976 | WARNING  | DDGS search failed for 'TST TRT labor decisions 2022 2023 2024 site:tst.com OR site:trt.gov': No results found.
2025-12-28 16:00:23.682 | WARNING  | DDGS search failed for 'site:trt*.jus.br "acordão" "emprego" 2023': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:05:09.857 | WARNING  | DDGS search failed for '"5:23-cv-" "employment" site:archive.org': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:05:48.399 | WARNING  | DDGS search failed for '"SDNY" "employment complaint" 2023 site:courtlistener.com': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:11:29.048 | WARNING  | DDGS search failed for 'site:ir.cvm.com.br prestação de serviços contrato de prestação de serviços 2023 filetype:pdf': No results found.
2025-12-28 16:11:58.508 | WARNING  | DDGS search failed for 'site:sec.gov "Exhibit 10" "SAAS agreement" filetype:pdf': No results found.
2025-12-28 16:15:43.905 | ERROR    | ❌ Pattern 1: Implicit output_type failed: status_code: 400, model_name: zai-glm-4.6, body: {'message': "Failed to generate tool_calls. Exception: Failed to generate tool call but tool_choice = 'required'.", 'type': 'generation_error', 'code': 'parser_error'}
Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 581, in _completions_create
    return await self.client.chat.completions.create(
                 │    │      │    │           └ <function AsyncCompletions.create at 0x109e65380>
                 │    │      │    └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a3b5010>
                 │    │      └ <openai.resources.chat.chat.AsyncChat object at 0x10a3b4c20>
                 │    └ <openai.AsyncOpenAI object at 0x109bd9550>
                 └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/resources/chat/completions/completions.py", line 2678, in create
    return await self._post(
                 │    └ <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x109bd9550>>
                 └ <openai.resources.chat.completions.completions.AsyncCompletions object at 0x10a3b5010>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1797, in post
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 │    │       │        │            │                  └ openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 │    │       │        │            └ False
                 │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers={'User-Agent': 'pydantic-ai/1.39.0'}, max_retr...
                 │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 │    └ <function AsyncAPIClient.request at 0x109737690>
                 └ <openai.AsyncOpenAI object at 0x109bd9550>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/openai/_base_client.py", line 1597, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x10972dc70>
          └ <openai.AsyncOpenAI object at 0x109bd9550>

openai.BadRequestError: Error code: 400 - {'message': "Failed to generate tool_calls. Exception: Failed to generate tool call but tool_choice = 'required'.", 'type': 'generation_error', 'code': 'parser_error'}


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 891, in <module>
    uvloop.run(main())
    │      │   └ <function main at 0x109c69900>
    │      └ <function run at 0x101797320>
    └ <module 'uvloop' from '/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-pack...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 96, in run
    return __asyncio.run(
           │         └ <function run at 0x1016768d0>
           └ <module 'asyncio' from '/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/__init...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 204, in run
    return runner.run(main)
           │      │   └ <coroutine object run.<locals>.wrapper at 0x109c35e00>
           │      └ <function Runner.run at 0x101676e50>
           └ <asyncio.runners.Runner object at 0x109bdaf90>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/asyncio/runners.py", line 127, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<run.<locals>.wrapper() running at /Users/arthrod/temp/Manual Library/temp/pydantic-ai-cereb...
           │    │     └ <cyfunction Loop.run_until_complete at 0x10170e980>
           │    └ <uvloop.Loop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109bdaf90>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/uvloop/__init__.py", line 48, in wrapper
    return await main
                 └ <coroutine object main at 0x109c266b0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 886, in main
    await run_comparison(prompt, target=5, prompt_idx=idx)
          │              │                            └ 4
          │              └ 'Collect 4 lease agreements: 2 Brazilian commercial leases (locação não-residencial) from São Paulo registry, 2 American comm...
          └ <function run_comparison at 0x109c69bc0>

> File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 821, in run_comparison
    result = await runner(prompt, target)
                   │      │       └ 5
                   │      └ 'Collect 4 lease agreements: 2 Brazilian commercial leases (locação não-residencial) from São Paulo registry, 2 American comm...
                   └ <function run_pattern1 at 0x109c39bc0>

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/patterns.py", line 288, in run_pattern1
    result = await pattern1_agent.run(prompt, deps=deps)
                   │              │   │            └ Deps(items=[{'id': 'brazilian_lease_nos8_2021', 'content': 'CONTRATO DE LOCAÇÃO DE IMÓVEL NÃO RESIDENCIAL\n\nEstando assim ju...
                   │              │   └ 'Collect 4 lease agreements: 2 Brazilian commercial leases (locação não-residencial) from São Paulo registry, 2 American comm...
                   │              └ <function AbstractAgent.run at 0x108fd2c40>
                   └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=ToolOutput(output=...

  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/abstract.py", line 258, in run
    async with self.iter(
               │    └ <function Agent.iter at 0x108ff4720>
               └ Agent(model=CerebrasModel(), name='pattern1_agent', end_strategy='early', model_settings=None, output_type=ToolOutput(output=...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a9262d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Agent.iter at 0xa99d8ef90>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10bf3be00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/agent/__init__.py", line 705, in iter
    async with graph.iter(
               │     └ <function Graph.iter at 0x108ed10c0>
               └ <pydantic_graph.beta.graph.Graph object at 0x10a925010
                 stateDiagram-v2
                   UserPromptNode
                   state decision <<choice>>
                   CallToo...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 235, in __aexit__
    await self.gen.athrow(value)
          │    │   │      └ CancelledError('Cancelled via cancel scope 10a9262d0')
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object Graph.iter at 0x109bdb4c0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x10a965b00>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 270, in iter
    async with GraphRun[StateT, DepsT, OutputT](
               │        │       │      └ OutputT
               │        │       └ DepsT
               │        └ StateT
               └ <class 'pydantic_graph.beta.graph.GraphRun'>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 423, in __aexit__
    await self._async_exit_stack.__aexit__(exc_type, exc_val, exc_tb)
          │    │                 │         │         │        └ <traceback object at 0x10a9899c0>
          │    │                 │         │         └ CancelledError('Cancelled via cancel scope 10a9262d0')
          │    │                 │         └ <class 'asyncio.exceptions.CancelledError'>
          │    │                 └ <function AsyncExitStack.__aexit__ at 0x1014cda60>
          │    └ <contextlib.AsyncExitStack object at 0x10a93cc80>
          └ <pydantic_graph.beta.graph.GraphRun object at 0x10a742970>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 768, in __aexit__
    raise exc
          └ ModelHTTPError('status_code: 400, model_name: zai-glm-4.6, body: {\'message\': "Failed to generate tool_calls. Exception: Fai...
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 749, in __aexit__
    cb_suppress = cb(*exc_details)
                  │   └ (<class 'ExceptionGroup'>, ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 400, model_name: z...
                  └ <bound method _GeneratorContextManager.__exit__ of <contextlib._GeneratorContextManager object at 0x10a965c50>>
  File "/Users/arthrod/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/lib/python3.14/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    │    │   │     └ ExceptionGroup('unhandled errors in a TaskGroup', [ModelHTTPError('status_code: 400, model_name: zai-glm-4.6, body: {\'messag...
    │    │   └ <method 'throw' of 'generator' objects>
    │    └ <generator object _unwrap_exception_groups at 0x10a95c900>
    └ <contextlib._GeneratorContextManager object at 0x10a965c50>
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 981, in _unwrap_exception_groups
    raise exception
          └ ModelHTTPError('status_code: 400, model_name: zai-glm-4.6, body: {\'message\': "Failed to generate tool_calls. Exception: Fai...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 750, in _run_tracked_task
    result = await self._run_task(t_)
                   │    │         └ GraphTask(node_id='ModelRequestNode', inputs=ModelRequestNode(request=ModelRequest(parts=[ToolReturnPart(tool_name='_save', c...
                   │    └ <function _GraphIterator._run_task at 0x108ed81a0>
                   └ _GraphIterator(graph=<pydantic_graph.beta.graph.Graph object at 0x10a925010
                     stateDiagram-v2
                       UserPromptNode
                       state decision...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/graph.py", line 782, in _run_task
    output = await node.call(step_context)
                   │    │    └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 lease agreements: 2...
                   │    └ <property object at 0x108e7eb10>
                   └ NodeStep(id='ModelRequestNode', _call=<bound method NodeStep._call_node of ...>, label=None)
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_graph/beta/step.py", line 253, in _call_node
    return await node.run(GraphRunContext(state=ctx.state, deps=ctx.deps))
                 │    │   │                     │   │           │   └ <property object at 0x108e7ddf0>
                 │    │   │                     │   │           └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 lease agreements: 2...
                 │    │   │                     │   └ <property object at 0x108e7dda0>
                 │    │   │                     └ StepContext(_state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 lease agreements: 2...
                 │    │   └ <class 'pydantic_graph.nodes.GraphRunContext'>
                 │    └ <function ModelRequestNode.run at 0x108fb4670>
                 └ ModelRequestNode(request=ModelRequest(parts=[ToolReturnPart(tool_name='_save', content='Saved. Progress: 5/5 items.', tool_ca...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 449, in run
    return await self._make_request(ctx)
                 │    │             └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 lease agreements...
                 │    └ <function ModelRequestNode._make_request at 0x108fb49e0>
                 └ ModelRequestNode(request=ModelRequest(parts=[ToolReturnPart(tool_name='_save', content='Saved. Progress: 5/5 items.', tool_ca...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/_agent_graph.py", line 494, in _make_request
    model_response = await ctx.deps.model.request(message_history, model_settings, model_request_parameters)
                           │   │    │     │       │                │               └ ModelRequestParameters(function_tools=[ToolDefinition(name='_search', parameters_json_schema={'additionalProperties': False, ...
                           │   │    │     │       │                └ {'cerebras_disable_reasoning': True}
                           │   │    │     │       └ [ModelRequest(parts=[UserPromptPart(content='Collect 4 lease agreements: 2 Brazilian commercial leases (locação não-residenci...
                           │   │    │     └ <function OpenAIChatModel.request at 0x109968e00>
                           │   │    └ CerebrasModel()
                           │   └ GraphAgentDeps(user_deps=Deps(items=[{'id': 'brazilian_lease_nos8_2021', 'content': 'CONTRATO DE LOCAÇÃO DE IMÓVEL NÃO RESIDE...
                           └ GraphRunContext(state=GraphAgentState(message_history=[ModelRequest(parts=[UserPromptPart(content='Collect 4 lease agreements...
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 499, in request
    response = await self._completions_create(
                     │    └ <function OpenAIChatModel._completions_create at 0x109969430>
                     └ CerebrasModel()
  File "/Users/arthrod/temp/Manual Library/temp/pydantic-ai-cerebras-react-test/.venv/lib/python3.14/site-packages/pydantic_ai/models/openai.py", line 613, in _completions_create
    raise ModelHTTPError(status_code=status_code, model_name=self.model_name, body=e.body) from e
          │                          │                       │    └ <property object at 0x109923150>
          │                          │                       └ CerebrasModel()
          │                          └ 400
          └ <class 'pydantic_ai.exceptions.ModelHTTPError'>

pydantic_ai.exceptions.ModelHTTPError: status_code: 400, model_name: zai-glm-4.6, body: {'message': "Failed to generate tool_calls. Exception: Failed to generate tool call but tool_choice = 'required'.", 'type': 'generation_error', 'code': 'parser_error'}
2025-12-28 16:16:56.585 | WARNING  | DDGS search failed for 'site:cartoriosp.org.br locação não residencial contrato modelo PDF': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:17:16.657 | WARNING  | DDGS search failed for '"contrato de locação não residencial" site:scribd.com São Paulo': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:19:48.421 | WARNING  | DDGS search failed for 'site:scholar.google.com "petição inicial" "Tribunal de Justiça de São Paulo" cível': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:21:07.483 | WARNING  | DDGS search failed for '"petição inicial" "Tribunal de Justiça de São Paulo" site:forum.conjur.com.br': No results found.
2025-12-28 16:21:17.046 | WARNING  | DDGS search failed for '"petição inicial" "TJSP" "processo" site:pensardireito.com.br': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:24:15.687 | WARNING  | DDGS search failed for 'site:jurisprudencia.tjsp.jus.br "petição inicial" processo PDF completo': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:27:04.193 | WARNING  | DDGS search failed for 'site:tj.sp.jus.br "contestação" processo número PDF': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:29:40.230 | WARNING  | DDGS search failed for 'opposition to motion for summary judgment PDF site:justice.gov.gov': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:32:00.076 | WARNING  | DDGS search failed for 'site:scopus.com "legal opinion" "law firm" journal pdf Brazil': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:32:22.579 | WARNING  | DDGS search failed for 'site:sec.gov/divisions/corpfin/pdf no-action letter opinion': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:32:36.096 | WARNING  | DDGS search failed for 'site:sec.gov/divisions/investment/noaction 2000 pdf': No results found.
2025-12-28 16:33:14.528 | WARNING  | DDGS search failed for '"parecer jurídico" site:revistadostribunais.com.br pdf': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:35:15.562 | WARNING  | DDGS search failed for 'PGE parecer jurídico site:gde.gov.br filetype:pdf': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:40:05.131 | WARNING  | DDGS search failed for '"Private Letter Ruling 2024" PLR number site:irs.gov': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:56:11.302 | WARNING  | DDGS search failed for '"mandado de segurança" tributário site:trf*.jus.br pdf': Request timed out: ConnectTimeout('timed out')
2025-12-28 16:59:09.937 | WARNING  | DDGS search failed for 'site:taxtreaties.gov IRS Chief Counsel Advice PDF 2023 2024': Request timed out: ConnectTimeout('timed out')
